<!DOCTYPE html>

<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×”×•×¤×š ×¡×¨×˜×•× ×™× ×œ××¦×—×™×§×™× ğŸ˜‚</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

```
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        min-height: 100vh;
        padding: 20px;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
    }

    h1 {
        text-align: center;
        color: white;
        font-size: 3em;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .subtitle {
        text-align: center;
        color: white;
        font-size: 1.3em;
        margin-bottom: 30px;
    }

    .main-content {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
    }

    @media (max-width: 768px) {
        .main-content {
            grid-template-columns: 1fr;
        }
        
        h1 {
            font-size: 2em;
        }
    }

    .card {
        background: white;
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }

    .upload-section {
        text-align: center;
    }

    .upload-zone {
        border: 3px dashed #f5576c;
        border-radius: 15px;
        padding: 40px;
        margin-bottom: 20px;
        cursor: pointer;
        transition: all 0.3s;
        background: #fff5f7;
    }

    .upload-zone:hover {
        background: #ffe0e6;
        border-color: #e03e52;
    }

    .upload-zone.dragover {
        background: #ffd0d9;
        transform: scale(1.02);
    }

    .upload-icon {
        font-size: 4em;
        margin-bottom: 10px;
    }

    input[type="file"] {
        display: none;
    }

    .video-preview {
        width: 100%;
        max-height: 300px;
        border-radius: 10px;
        margin-top: 20px;
        display: none;
    }

    .effects-section h2 {
        color: #f5576c;
        margin-bottom: 20px;
        font-size: 1.8em;
    }

    .effect-group {
        margin-bottom: 25px;
    }

    .effect-group h3 {
        color: #333;
        margin-bottom: 10px;
        font-size: 1.2em;
    }

    .effect-options {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }

    .effect-btn {
        padding: 10px 20px;
        border: 2px solid #ddd;
        background: white;
        border-radius: 25px;
        cursor: pointer;
        transition: all 0.3s;
        font-size: 1em;
        font-weight: bold;
    }

    .effect-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .effect-btn.active {
        background: #f5576c;
        color: white;
        border-color: #f5576c;
    }

    .slider-group {
        margin-bottom: 15px;
    }

    .slider-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: #555;
    }

    input[type="range"] {
        width: 100%;
        height: 8px;
        border-radius: 5px;
        background: #ddd;
        outline: none;
        -webkit-appearance: none;
    }

    input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #f5576c;
        cursor: pointer;
    }

    input[type="range"]::-moz-range-thumb {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #f5576c;
        cursor: pointer;
        border: none;
    }

    .slider-value {
        display: inline-block;
        margin-right: 10px;
        color: #f5576c;
        font-weight: bold;
    }

    .action-buttons {
        display: flex;
        gap: 10px;
        margin-top: 20px;
    }

    .btn {
        flex: 1;
        padding: 15px;
        font-size: 1.1em;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.3s;
    }

    .btn-primary {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
    }

    .btn-primary:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(245, 87, 108, 0.4);
    }

    .btn-secondary {
        background: #6c757d;
        color: white;
    }

    .btn-secondary:hover {
        background: #5a6268;
    }

    .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .preview-section {
        position: relative;
    }

    .canvas-container {
        position: relative;
        width: 100%;
        display: none;
    }

    #canvas {
        width: 100%;
        border-radius: 10px;
        background: #000;
    }

    .processing {
        text-align: center;
        padding: 40px;
        display: none;
    }

    .processing.show {
        display: block;
    }

    .spinner {
        border: 5px solid #f3f3f3;
        border-top: 5px solid #f5576c;
        border-radius: 50%;
        width: 60px;
        height: 60px;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .download-section {
        display: none;
        text-align: center;
        padding: 20px;
        background: #d4edda;
        border-radius: 10px;
        margin-top: 20px;
    }

    .download-section.show {
        display: block;
    }

    .recording-indicator {
        display: none;
        text-align: center;
        padding: 20px;
        background: #fff3cd;
        border-radius: 10px;
        margin-top: 20px;
        border: 2px solid #ffc107;
    }

    .recording-indicator.show {
        display: block;
    }

    .recording-dot {
        width: 12px;
        height: 12px;
        background: #dc3545;
        border-radius: 50%;
        animation: pulse 1.5s ease-in-out infinite;
    }

    @keyframes pulse {
        0%, 100% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.5; transform: scale(1.2); }
    }

    .info-box {
        background: #fff3cd;
        border: 2px solid #ffc107;
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 20px;
    }

    .info-box h4 {
        color: #856404;
        margin-bottom: 5px;
    }

    .info-box p {
        color: #856404;
        font-size: 0.9em;
    }

    .effects-section {
        max-height: 600px;
        overflow-y: auto;
    }

    .effects-section::-webkit-scrollbar {
        width: 8px;
    }

    .effects-section::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
    }

    .effects-section::-webkit-scrollbar-thumb {
        background: #f5576c;
        border-radius: 10px;
    }
</style>
```

</head>
<body>
    <div class="container">
        <h1>ğŸ¬ ×”×•×¤×š ×¡×¨×˜×•× ×™× ×œ××¦×—×™×§×™× ğŸ˜‚</h1>
        <p class="subtitle">×”×¢×œ×” ×¡×¨×˜×•×Ÿ ×•×”×¤×•×š ××•×ª×• ×œ××©×”×• ××’×•×—×š!</p>

```
    <div class="main-content">
        <!-- Upload Section -->
        <div class="card upload-section">
            <h2 style="color: #f5576c; margin-bottom: 20px;">ğŸ“¤ ×”×¢×œ×” ×¡×¨×˜×•×Ÿ</h2>
            
            <div class="upload-zone" id="uploadZone">
                <div class="upload-icon">ğŸ¥</div>
                <h3>×’×¨×•×¨ ×¡×¨×˜×•×Ÿ ×œ×›××Ÿ</h3>
                <p>××• ×œ×—×¥ ×œ×‘×—×™×¨×ª ×§×•×‘×¥</p>
                <p style="color: #999; font-size: 0.9em; margin-top: 10px;">×ª×•××š ×‘-MP4, MOV, AVI, WebM</p>
            </div>
            <input type="file" id="fileInput" accept="video/*">
            
            <video id="inputVideo" class="video-preview" controls muted></video>
            
            <div class="action-buttons" style="display: none;" id="actionButtons">
                <button class="btn btn-primary" id="processBtn" disabled>
                    âœ¨ ×”×¤×•×š ×œ××¦×—×™×§!
                </button>
                <button class="btn btn-secondary" id="resetBtn">
                    ğŸ”„ ×¡×¨×˜×•×Ÿ ×—×“×©
                </button>
            </div>
        </div>

        <!-- Effects Section -->
        <div class="card effects-section">
            <h2>ğŸ¨ ××¤×§×˜×™× ××’×•×—×›×™×</h2>
            
            <div class="info-box">
                <h4>ğŸ’¡ ×˜×™×¤</h4>
                <p>×‘×—×¨ ×›××” ××¤×§×˜×™× ×©×ª×¨×¦×” ×•×”×ª×× ××ª ×”×¢×•×¦××” ×©×œ×”×!</p>
            </div>

            <div class="effect-group">
                <h3>ğŸ­ ××¤×§×˜×™× ×•×™×–×•××œ×™×™×</h3>
                <div class="effect-options">
                    <button class="effect-btn" data-effect="zoom">ğŸ” ×–×•× ××˜×•×¨×£</button>
                    <button class="effect-btn" data-effect="shake">ğŸ“³ ×¨×¢×™×“×•×ª</button>
                    <button class="effect-btn" data-effect="rainbow">ğŸŒˆ ×¦×‘×¢×™×</button>
                    <button class="effect-btn" data-effect="mirror">ğŸª ××¨××”</button>
                    <button class="effect-btn" data-effect="pixelate">ğŸ® ×¤×™×§×¡×œ×™×</button>
                    <button class="effect-btn" data-effect="spin">ğŸŒ€ ×¡×—×¨×•×¨</button>
                    <button class="effect-btn" data-effect="glitch">âš¡ ×’×œ×™×¥'</button>
                    <button class="effect-btn" data-effect="warp">ğŸŒŠ ×¢×™×•×•×ª ×’×œ×™</button>
                </div>
            </div>

            <div class="effect-group">
                <h3>ğŸ’¥ ×ª×•×¡×¤×•×ª</h3>
                <div class="effect-options">
                    <button class="effect-btn" data-effect="emojis">ğŸ˜‚ ××™××•×’'×™×</button>
                    <button class="effect-btn" data-effect="explosions">ğŸ’¥ ×¤×™×¦×•×¦×™×</button>
                    <button class="effect-btn" data-effect="stars">â­ ×›×•×›×‘×™×</button>
                    <button class="effect-btn" data-effect="text">ğŸ“ ×˜×§×¡×˜</button>
                    <button class="effect-btn" data-effect="memes">ğŸ¤¡ ××™××–</button>
                    <button class="effect-btn" data-effect="lasers">ğŸ”´ ×œ×™×™×–×¨×™×</button>
                    <button class="effect-btn" data-effect="money">ğŸ’° ×›×¡×£</button>
                </div>
            </div>

            <div class="effect-group">
                <h3>ğŸª ××¤×§×˜×™× ××•×–×¨×™×</h3>
                <div class="effect-options">
                    <button class="effect-btn" data-effect="eyes">ğŸ‘€ ×¢×™× ×™×™×</button>
                    <button class="effect-btn" data-effect="oldfilm">ğŸ“½ï¸ ×¡×¨×˜ ×™×©×Ÿ</button>
                    <button class="effect-btn" data-effect="matrix">ğŸŸ¢ ××˜×¨×™×§×¡</button>
                    <button class="effect-btn" data-effect="disco">ğŸ•º ×“×™×¡×§×•</button>
                    <button class="effect-btn" data-effect="alien">ğŸ‘½ ×—×™×™×–×¨×™×</button>
                    <button class="effect-btn" data-effect="bruh">ğŸ—£ï¸ BRUH</button>
                    <button class="effect-btn" data-effect="mlg">ğŸ˜ MLG</button>
                </div>
            </div>

            <div class="slider-group">
                <label>
                    <span class="slider-value" id="intensityValue">50%</span>
                    ×¢×•×¦××ª ×”××¤×§×˜×™×
                </label>
                <input type="range" id="intensitySlider" min="0" max="100" value="50">
            </div>

            <div class="slider-group">
                <label>
                    <span class="slider-value" id="speedValue">1.0x</span>
                    ××”×™×¨×•×ª ×”×¡×¨×˜×•×Ÿ
                </label>
                <input type="range" id="speedSlider" min="50" max="300" value="100" step="10">
            </div>
        </div>
    </div>

    <!-- Processing/Preview Section -->
    <div class="card">
        <h2 style="color: #f5576c; margin-bottom: 20px;">ğŸ¬ ×ª×•×¦××”</h2>
        
        <div class="processing" id="processing">
            <div class="spinner"></div>
            <h3>××¢×‘×“ ××ª ×”×¡×¨×˜×•×Ÿ ×©×œ×š...</h3>
            <p>××•×¡×™×£ ××¤×§×˜×™× ××’×•×—×›×™×! ğŸ˜„</p>
        </div>

        <div class="canvas-container" id="canvasContainer">
            <canvas id="canvas"></canvas>
        </div>

        <div class="recording-indicator" id="recordingIndicator">
            <div style="display: flex; align-items: center; gap: 10px; justify-content: center;">
                <div class="recording-dot"></div>
                <span>××§×œ×™×˜ ×•×××™×¨ ××ª ×”×¡×¨×˜×•×Ÿ...</span>
            </div>
            <div style="margin-top: 10px; font-size: 0.9em; color: #666;">
                ×–×” ×¢×©×•×™ ×œ×§×—×ª ×›××” ×¨×’×¢×™×
            </div>
        </div>

        <div class="download-section" id="downloadSection"></div>
    </div>
</div>

<script>
    const uploadZone = document.getElementById('uploadZone');
    const fileInput = document.getElementById('fileInput');
    const inputVideo = document.getElementById('inputVideo');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d', { willReadFrequently: true });
    const processBtn = document.getElementById('processBtn');
    const resetBtn = document.getElementById('resetBtn');
    const actionButtons = document.getElementById('actionButtons');
    const processing = document.getElementById('processing');
    const canvasContainer = document.getElementById('canvasContainer');
    const downloadSection = document.getElementById('downloadSection');
    const intensitySlider = document.getElementById('intensitySlider');
    const speedSlider = document.getElementById('speedSlider');

    let selectedEffects = new Set();
    let videoFile = null;
    let isProcessing = false;
    let animationId = null;
    let mediaRecorder = null;
    let recordedChunks = [];
    let isRecording = false;
    let frameCount = 0;
    let particles = [];
    let eyes = [];
    let matrixChars = [];

    // Upload handlers
    uploadZone.addEventListener('click', () => fileInput.click());
    
    uploadZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadZone.classList.add('dragover');
    });

    uploadZone.addEventListener('dragleave', () => {
        uploadZone.classList.remove('dragover');
    });

    uploadZone.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadZone.classList.remove('dragover');
        const file = e.dataTransfer.files[0];
        if (file && file.type.startsWith('video/')) {
            handleVideoUpload(file);
        } else {
            alert('×× × ×”×¢×œ×” ×§×•×‘×¥ ×•×™×“××• ×ª×§×™×Ÿ');
        }
    });

    fileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
            handleVideoUpload(file);
        }
    });

    function handleVideoUpload(file) {
        videoFile = file;
        const url = URL.createObjectURL(file);
        inputVideo.src = url;
        inputVideo.style.display = 'block';
        actionButtons.style.display = 'flex';
        
        inputVideo.onloadedmetadata = () => {
            processBtn.disabled = false;
        };
        
        inputVideo.onerror = () => {
            alert('×©×’×™××” ×‘×˜×¢×™× ×ª ×”×¡×¨×˜×•×Ÿ. × ×¡×” ×§×•×‘×¥ ××—×¨.');
            processBtn.disabled = true;
        };
    }

    // Effect buttons
    document.querySelectorAll('.effect-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const effect = btn.dataset.effect;
            if (selectedEffects.has(effect)) {
                selectedEffects.delete(effect);
                btn.classList.remove('active');
            } else {
                selectedEffects.add(effect);
                btn.classList.add('active');
            }
        });
    });

    // Sliders
    intensitySlider.addEventListener('input', (e) => {
        document.getElementById('intensityValue').textContent = e.target.value + '%';
    });

    speedSlider.addEventListener('input', (e) => {
        const speed = e.target.value / 100;
        document.getElementById('speedValue').textContent = speed.toFixed(1) + 'x';
    });

    // Process video
    processBtn.addEventListener('click', () => {
        if (!videoFile || isProcessing) return;
        
        isProcessing = true;
        processBtn.disabled = true;
        processing.classList.add('show');
        canvasContainer.style.display = 'none';
        downloadSection.classList.remove('show');
        downloadSection.innerHTML = '';

        // Reset state
        frameCount = 0;
        particles = [];
        eyes = [];
        matrixChars = [];

        setTimeout(() => {
            processing.classList.remove('show');
            startVideoProcessing();
        }, 1500);
    });

    function startVideoProcessing() {
        // Set canvas size
        canvas.width = inputVideo.videoWidth || 640;
        canvas.height = inputVideo.videoHeight || 480;
        canvasContainer.style.display = 'block';
        
        const recordingIndicator = document.getElementById('recordingIndicator');
        if (recordingIndicator) {
            recordingIndicator.classList.add('show');
        }
        
        // Check if MediaRecorder is supported
        let stream;
        try {
            stream = canvas.captureStream(30);
        } catch (e) {
            alert('×”×“×¤×“×¤×Ÿ ×©×œ×š ×œ× ×ª×•××š ×‘×”×§×œ×˜×ª ×•×™×“××•. × ×¡×” Chrome ××• Firefox ××¢×•×“×›× ×™×.');
            isProcessing = false;
            processBtn.disabled = false;
            recordingIndicator.classList.remove('show');
            return;
        }

        // Determine MIME type
        let mimeType = 'video/webm;codecs=vp9';
        if (!MediaRecorder.isTypeSupported(mimeType)) {
            mimeType = 'video/webm;codecs=vp8';
            if (!MediaRecorder.isTypeSupported(mimeType)) {
                mimeType = 'video/webm';
            }
        }
        
        try {
            mediaRecorder = new MediaRecorder(stream, {
                mimeType: mimeType,
                videoBitsPerSecond: 2500000
            });
        } catch (e) {
            alert('×©×’×™××” ×‘×™×¦×™×¨×ª ×”×”×§×œ×˜×”: ' + e.message);
            isProcessing = false;
            processBtn.disabled = false;
            recordingIndicator.classList.remove('show');
            return;
        }
        
        recordedChunks = [];
        
        mediaRecorder.ondataavailable = (event) => {
            if (event.data && event.data.size > 0) {
                recordedChunks.push(event.data);
            }
        };
        
        mediaRecorder.onstop = () => {
            if (recordingIndicator) {
                recordingIndicator.classList.remove('show');
            }
            
            if (recordedChunks.length === 0) {
                alert('×œ× ×”×¦×œ×—× ×• ×œ×”×§×œ×™×˜ ××ª ×”×¡×¨×˜×•×Ÿ. × ×¡×” ×©×•×‘.');
                isProcessing = false;
                processBtn.disabled = false;
                return;
            }
            
            const blob = new Blob(recordedChunks, { type: mimeType });
            const url = URL.createObjectURL(blob);
            
            downloadSection.innerHTML = `
                <h3 style="color: #155724; margin-bottom: 15px;">âœ… ×”×¡×¨×˜×•×Ÿ ××•×›×Ÿ!</h3>
                <p style="margin-bottom: 15px;">×”×¡×¨×˜×•×Ÿ ×©×œ×š ×¢×›×©×™×• ×™×•×ª×¨ ××¦×—×™×§! ğŸ‰</p>
                <video src="${url}" controls style="width: 100%; border-radius: 10px; margin-bottom: 15px;"></video>
                <button class="btn btn-primary" onclick="downloadVideo('${url}', '${mimeType}')">
                    â¬‡ï¸ ×”×•×¨×“ ×¡×¨×˜×•×Ÿ
                </button>
            `;
            
            downloadSection.classList.add('show');
            isProcessing = false;
            processBtn.disabled = false;
        };
        
        mediaRecorder.onerror = (e) => {
            console.error('Recording error:', e);
            alert('×©×’×™××” ×‘×”×§×œ×˜×”. × ×¡×” ×©×•×‘.');
            isProcessing = false;
            processBtn.disabled = false;
            if (recordingIndicator) {
                recordingIndicator.classList.remove('show');
            }
        };
        
        inputVideo.currentTime = 0;
        inputVideo.muted = true;
        
        inputVideo.onended = () => {
            if (isRecording && mediaRecorder && mediaRecorder.state === 'recording') {
                mediaRecorder.stop();
                isRecording = false;
            }
        };
        
        inputVideo.play().then(() => {
            const speed = speedSlider.value / 100;
            inputVideo.playbackRate = speed;
            
            mediaRecorder.start();
            isRecording = true;
            
            renderFrame();
        }).catch(e => {
            alert('×©×’×™××” ×‘×”×¤×¢×œ×ª ×”×¡×¨×˜×•×Ÿ: ' + e.message);
            isProcessing = false;
            processBtn.disabled = false;
        });
    }

    function downloadVideo(url, mimeType) {
        const a = document.createElement('a');
        a.href = url;
        const extension = mimeType.includes('webm') ? 'webm' : 'mp4';
        a.download = `funny-video-${Date.now()}.${extension}`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    }
    
    function renderFrame() {
        if (inputVideo.paused || inputVideo.ended) {
            if (isRecording && mediaRecorder && mediaRecorder.state === 'recording') {
                mediaRecorder.stop();
                isRecording = false;
            }
            return;
        }

        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        const intensity = intensitySlider.value / 100;
        
        ctx.save();
        
        // Transform effects
        if (selectedEffects.has('zoom')) {
            const scale = 1 + Math.sin(frameCount * 0.1) * 0.3 * intensity;
            ctx.translate(canvas.width / 2, canvas.height / 2);
            ctx.scale(scale, scale);
            ctx.translate(-canvas.width / 2, -canvas.height / 2);
        }
        
        if (selectedEffects.has('shake')) {
            const shakeX = (Math.random() - 0.5) * 20 * intensity;
            const shakeY = (Math.random() - 0.5) * 20 * intensity;
            ctx.translate(shakeX, shakeY);
        }
        
        if (selectedEffects.has('mirror')) {
            ctx.translate(canvas.width, 0);
            ctx.scale(-1, 1);
        }
        
        if (selectedEffects.has('spin')) {
            ctx.translate(canvas.width / 2, canvas.height / 2);
            ctx.rotate((frameCount * 0.02 * intensity));
            ctx.translate(-canvas.width / 2, -canvas.height / 2);
        }
        
        // Draw video
        try {
            ctx.drawImage(inputVideo, 0, 0, canvas.width, canvas.height);
        } catch (e) {
            console.error('Draw error:', e);
        }
        
        if (selectedEffects.has('warp')) {
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const tempCanvas = document.createElement('canvas');
            const tempCtx = tempCanvas.getContext('2d');
            tempCanvas.width = canvas.width;
            tempCanvas.height = canvas.height;
            tempCtx.putImageData(imageData, 0, 0);
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            for (let y = 0; y < canvas.height; y += 2) {
                const offset = Math.sin((y + frameCount) * 0.05) * 10 * intensity;
                ctx.drawImage(tempCanvas, 0, y, canvas.width, 2, offset, y, canvas.width, 2);
            }
        }
        
        if (selectedEffects.has('rainbow')) {
            ctx.globalCompositeOperation = 'overlay';
            const hue = (frameCount * 5) % 360;
            ctx.fillStyle = `hsla(${hue}, 100%, 50%, ${0.3 * intensity})`;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.globalCompositeOperation = 'source-over';
        }
        
        if (selectedEffects.has('glitch') && Math.random() < 0.1 * intensity) {
            const sliceHeight = 20;
            const y = Math.random() * (canvas.height - sliceHeight);
            const offset = (Math.random() - 0.5) * 50 * intensity;
            const imageData = ctx.getImageData(0, y, canvas.width, sliceHeight);
            ctx.putImageData(imageData, offset, y);
        }
        
        if (selectedEffects.has('pixelate')) {
            const pixelSize = Math.max(2, Math.floor(10 * intensity));
            const tempCanvas = document.createElement('canvas');
            const tempCtx = tempCanvas.getContext('2d');
            tempCanvas.width = Math.max(1, canvas.width / pixelSize);
            tempCanvas.height = Math.max(1, canvas.height / pixelSize);
            tempCtx.drawImage(canvas, 0, 0, tempCanvas.width, tempCanvas.height);
            ctx.imageSmoothingEnabled = false;
            ctx.drawImage(tempCanvas, 0, 0, canvas.width, canvas.height);
            ctx.imageSmoothingEnabled = true;
        }
        
        ctx.restore();
        
        // Overlay effects
        if (selectedEffects.has('disco')) {
            ctx.globalCompositeOperation = 'lighter';
            const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
            for (let i = 0; i < 3; i++) {
                const x = Math.random() * canvas.width;
                const y = Math.random() * canvas.height;
                const gradient = ctx.createRadialGradient(x, y, 0, x, y, 100 * intensity);
                gradient.addColorStop(0, colors[Math.floor(Math.random() * colors.length)] + '88');
                gradient.addColorStop(1, 'transparent');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }
            ctx.globalCompositeOperation = 'source-over';
        }
        
        if (selectedEffects.has('oldfilm')) {
            ctx.fillStyle = `rgba(0, 0, 0, ${0.1 * intensity})`;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            for (let i = 0; i < 3 * intensity; i++) {
                ctx.strokeStyle = `rgba(255, 255, 255, ${Math.random() * 0.3})`;
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(Math.random() * canvas.width, 0);
                ctx.lineTo(Math.random() * canvas.width, canvas.height);
                ctx.stroke();
            }
        }
        
        if (selectedEffects.has('matrix')) {
            if (matrixChars.length === 0) {
                for (let i = 0; i < 30; i++) {
                    matrixChars.push({
                        x: Math.random() * canvas.width,
                        y: Math.random() * canvas.height,
                        speed: Math.random() * 3 + 1
                    });
                }
            }
            
            ctx.fillStyle = `rgba(0, 255, 0, ${0.8 * intensity})`;
            ctx.font = '16px monospace';
            matrixChars.forEach(char => {
                const chars = '01ã‚¢ã‚¤ã‚¦';
                ctx.fillText(chars[Math.floor(Math.random() * chars.length)], char.x, char.y);
                char.y += char.speed;
                if (char.y > canvas.height) {
                    char.y = 0;
                    char.x = Math.random() * canvas.width;
                }
            });
        }
        
        // Particle effects
        if (selectedEffects.has('emojis') && frameCount % 10 === 0) {
            const emojis = ['ğŸ˜‚', 'ğŸ¤£', 'ğŸ˜†', 'ğŸ’€'];
            ctx.font = `${Math.floor(40 * intensity)}px Arial`;
            ctx.fillText(emojis[Math.floor(Math.random() * emojis.length)], 
                       Math.random() * canvas.width, Math.random() * canvas.height);
        }
        
        if (selectedEffects.has('explosions') && frameCount % 20 === 0) {
            ctx.font = `${Math.floor(60 * intensity)}px Arial`;
            ctx.fillText('ğŸ’¥', Math.random() * canvas.width, Math.random() * canvas.height);
        }
        
        if (selectedEffects.has('stars') && frameCount % 5 === 0) {
            ctx.font = `${Math.floor(30 * intensity)}px Arial`;
            ctx.fillText('â­', Math.random() * canvas.width, Math.random() * canvas.height);
        }
        
        if (selectedEffects.has('memes')) {
            if (frameCount % 15 === 0) {
                const memes = ['ğŸ¤¡', 'ğŸ’©', 'ğŸ•', 'ğŸ¦„'];
                particles.push({
                    x: Math.random() * canvas.width,
                    y: canvas.height,
                    emoji: memes[Math.floor(Math.random() * memes.length)],
                    vy: -2 - Math.random() * 2,
                    vx: (Math.random() - 0.5) * 2
                });
            }
            
            particles = particles.filter(p => p.y > -50);
            ctx.font = `${Math.floor(40 * intensity)}px Arial`;
            particles.forEach(p => {
                ctx.fillText(p.emoji, p.x, p.y);
                p.y += p.vy;
                p.x += p.vx;
            });
        }
        
        if (selectedEffects.has('lasers')) {
            for (let i = 0; i < Math.floor(3 * intensity); i++) {
                ctx.strokeStyle = `rgba(255, 0, 0, ${Math.random() * 0.8})`;
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(Math.random() * canvas.width, Math.random() * canvas.height);
                ctx.lineTo(Math.random() * canvas.width, Math.random() * canvas.height);
                ctx.stroke();
            }
        }
        
        if (selectedEffects.has('money') && frameCount % 8 === 0) {
            const money = ['ğŸ’µ', 'ğŸ’°'];
            ctx.font = `${Math.floor(35 * intensity)}px Arial`;
            ctx.fillText(money[Math.floor(Math.random() * money.length)], 
                       Math.random() * canvas.width, Math.random() * canvas.height);
        }
        
        if (selectedEffects.has('alien') && frameCount % 30 === 0) {
            ctx.font = `${Math.floor(50 * intensity)}px Arial`;
            const aliens = ['ğŸ‘½', 'ğŸ›¸'];
            ctx.fillText(aliens[Math.floor(Math.random() * aliens.length)], 
                       Math.random() * canvas.width, Math.random() * canvas.height);
        }
        
        if (selectedEffects.has('eyes')) {
            if (eyes.length === 0) {
                for (let i = 0; i < 8; i++) {
                    eyes.push({
                        x: Math.random() * canvas.width,
                        y: Math.random() * canvas.height,
                        size: 20 + Math.random() * 20
                    });
                }
            }
            
            ctx.font = `${Math.floor(25 * intensity)}px Arial`;
            eyes.forEach(eye => {
                ctx.fillText('ğŸ‘ï¸', eye.x, eye.y);
            });
        }
        
        if (selectedEffects.has('bruh')) {
            ctx.font = `bold ${Math.floor(60 * intensity)}px Impact, Arial`;
            ctx.fillStyle = 'white';
            ctx.strokeStyle = 'black';
            ctx.lineWidth = 3;
            const bruhTexts = ['BRUH', 'NO WAY', 'OMG'];
            const text = bruhTexts[Math.floor(frameCount / 40) % bruhTexts.length];
            const x = (canvas.width - ctx.measureText(text).width) / 2;
            ctx.strokeText(text, x, 60);
            ctx.fillText(text, x, 60);
        }
        
        if (selectedEffects.has('mlg')) {
            if (frameCount % 20 === 0) {
                ctx.font = `bold ${Math.floor(40 * intensity)}px Impact, Arial`;
                ctx.fillStyle = ['#00ff00', '#ff0000', '#ffff00'][Math.floor(Math.random() * 3)];
                ctx.strokeStyle = 'black';
                ctx.lineWidth = 2;
                const mlgTexts = ['MLG', 'PRO', 'EPIC'];
                const text = mlgTexts[Math.floor(Math.random() * mlgTexts.length)];
                const x = Math.random() * (canvas.width - 150);
                const y = Math.random() * (canvas.height - 100) + 50;
                ctx.strokeText(text, x, y);
                ctx.fillText(text, x, y);
            }
        }
        
        if (selectedEffects.has('text')) {
            const texts = ['LOL', 'WOW', 'HAHA'];
            ctx.font = `bold ${Math.floor(40 * intensity)}px Arial`;
            ctx.fillStyle = 'yellow';
            ctx.strokeStyle = 'black';
            ctx.lineWidth = 3;
            const text = texts[Math.floor(frameCount / 30) % texts.length];
            ctx.strokeText(text, 20, 50);
            ctx.fillText(text, 20, 50);
        }
        
        frameCount++;
        animationId = requestAnimationFrame(renderFrame);
    }

    resetBtn.addEventListener('click', () => {
        if (mediaRecorder && mediaRecorder.state === 'recording') {
            mediaRecorder.stop();
        }
        if (animationId) {
            cancelAnimationFrame(animationId);
        }
        particles = [];
        eyes = [];
        matrixChars = [];
        selectedEffects.clear();
        document.querySelectorAll('.effect-btn').forEach(btn => btn.classList.remove('active'));
        location.reload();
    });
</script>
```

</body>
</html>
